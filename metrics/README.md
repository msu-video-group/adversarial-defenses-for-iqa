## Ветка для прогона защит
### Структура
* `/methods` - не используется при запусках
* `/subjects` - папка с метриками, не отличается от остальных веток
* `/defences` - папка с защитами. Содержит подпапки-защиты по аналогии с атаками. Также внутри есть CI файл, папка utils со скриптами, отвечающими за прогон.
    * `/*название защиты*/` -- название защиты не должно содержать заглавных букв и нижних подчеркиваний, для разделения слов используйте -.
        * `run.py` - в папке с защитой обязательно должен быть файл `run.py`, содержащий класс `Defence`  с реализованным методом `__call__`, а также код, вызывающий функцию `test_main` (см любую защиту).
        * `dfsrc/` - если реализация защиты требует каких либо дополнительных скриптов или файлов, они должны находиться в этой папке. Она копируется в докер образ без изменений, при инициализации и использовании защиты она будет доступна. Если никаких дополнительных файлов для защиты не нужно, эту папку можно не создавать. Если для защиты требуется загрузить веса, добавьте в `dfsrc` скрипт `setup.sh`, качающий их wget'ом с титана или диона. Сам собой скрипт не запустится - добавьте его запуск при инициализации защиты или в начале файла `run.py` с помощью `subprocess.run()` (см защиты mprnet или fcn).
    * `ci.yml` - файл CI, аналогичный атакам. Если добавляете новую защиту, внесите в него соответствующую запись. Заметьте, что если в названии защиты есть - , то в строке `- if: $*название защиты* == "yes"` в названии защиты - заменяются на _.
    * `utils/` -- папка с основными скриптами для запуска защит
        * `defence_presets.json` - пресеты защит
        * `defence_evaluate.py` - основной скрипт, аналог `fgsm_evaluate.py` для атак.
        * `defence_dataset.py` - класс датасета, используемого при прогоне защит по атакованному датасету.
        * `defence_scoring_methods.py` - функции для вычисления различных скоров, по которым сравниваем защиты.
        * `Dockerfile` - основной докерфайл, задающий образ для прогона защит.
        * `read_dataset.py`, `evaluate.py`, `metrics.py` - прочие вспомогательные файлы.
* `/scripts` - основные баш скрипты и списки защит/метрик/атак. Из важного:
    * `attack-test.sh` - скрипт, запускающий test джобы защит. В начале этого скрипта находятся все основные параметры, контролирующие прогон: пресет, батч сайз, пути до датасетов и тд.
    * `defences.txt` - список защит. При добавлении новой защиты нужно добавить сюда название.
